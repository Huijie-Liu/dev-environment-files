# ===========================
# 1. Shell 主题和界面配置
# ===========================
# Starship prompt
eval "$(starship init zsh)"

# ===========================
# 2. 环境变量配置
# ===========================
# 常用路径配置
export PATH="/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/snap/bin"
export PATH="$HOME/.local/bin:$HOME/.local/usr/bin:$PATH"
export PATH="$HOME/.cargo/bin:/usr/local/cuda-$CUDA_VERSION/bin:$PATH"
export PATH=$(echo "$PATH" | tr ':' '\n' | tac | awk '!x[$0]++' | tac | tr '\n' ':')

# CUDA 和库路径
export CUDA_VERSION="11.8"
export CUDA_HOME="/usr/local/cuda-$CUDA_VERSION"
export PKG_CONFIG_PATH="$HOME/.local/lib/pkgconfig:$PKG_CONFIG_PATH"
export LD_LIBRARY_PATH="/usr/local/cuda-$CUDA_VERSION/lib64:$HOME/.local/lib:$HOME/.local/usr/lib:$HOME/.local/usr/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH"

# Hugging Face 镜像和临时文件路径
export HF_ENDPOINT="https://hf-mirror.com"
export TMPDIR="$HOME/.tmp"

# ===========================
# 3. 历史记录配置
# ===========================
HISTFILE="$HOME/.histfile"
HISTSIZE=50000
SAVEHIST=$HISTSIZE
setopt inc_append_history       # 自动追加历史记录
setopt share_history            # 多个终端共享历史
setopt hist_expire_dups_first    # 删除重复的历史记录
setopt hist_ignore_dups         # 忽略连续重复的命令
setopt hist_verify              # 编辑历史命令前的确认

# ===========================
# 4. 代理配置
# ===========================
export http_proxy="http://127.0.0.1:17890"
export https_proxy="http://127.0.0.1:17890"

# 代理控制别名
alias proxy='export http_proxy=http://127.0.0.1:17890; export https_proxy=http://127.0.0.1:17890 && echo 代理成功'
alias unproxy='export http_proxy=; export https_proxy= && echo 取消代理成功'

# ===========================
# 5. 常用别名
# ===========================
# 文件管理别名
alias ls="eza --color=always --git --no-filesize --icons=always --no-time --no-user --no-permissions"
alias l="ls -la"
alias ll="ls -l"
alias la="ls -a"
alias ..="cd .."
alias ...="cd ../.."

# 历史记录别名
alias h="history -10"
alias hc="history -c"
alias hg="history | grep "

# 文件操作别名
alias md="mkdir -p"
alias rd="rmdir"

# Tmux 控制别名
alias ta="tmux attach"
alias tl="tmux list-session"
alias ts="tmux new-session"

# 终端控制别名
alias c="clear"
alias x="exit"
alias r="source ~/.zshrc"
alias e="nvim ~/.zshrc"
alias f="find . -name"
alias dud="du -h -d 1"
alias duds="du -h -d 1 | sort -h"

# Git 相关别名
alias g="git"
alias ga="git add"
alias gaa="git add --all"
alias gb="git branch"
alias gba="git branch --all"
alias gbd="git branch --delete"
alias gc="git commit --verbose"
alias gca="git commit --verbose --all"
alias gst="git status"
alias gss="git status --short"
alias gl="git pull"
alias glg="git log --stat"
alias glgg="git log --graph"
alias glgga="git log --graph --decorate --all"
alias glgm="git log --graph --max-count=10"
alias glods='git log --graph --pretty="%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%ad) %C(bold blue)<%an>%Creset" --date=short'
alias glod='git log --graph --pretty="%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%ad) %C(bold blue)<%an>%Creset"'
alias glola='git log --graph --pretty="%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%ar) %C(bold blue)<%an>%Creset" --all'
alias glols='git log --graph --pretty="%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%ar) %C(bold blue)<%an>%Creset" --stat'
alias glol='git log --graph --pretty="%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%ar) %C(bold blue)<%an>%Creset"'
alias glo='git log --oneline --decorate'
alias glog='git log --oneline --decorate --graph'
alias gloga='git log --oneline --decorate --graph --all'

# 自定义别名
alias nvs="nvidia-smi"
alias lg="lazygit"
alias clash="bash ~/.app/clash-for-linux/start.sh"

# ===========================
# 6. FZF 配置
# ===========================
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
source <(fzf --zsh)
export FZF_DEFAULT_OPTS=$FZF_DEFAULT_OPTS'
  --reverse
  --color=fg:-1,fg+:#d0d0d0,bg:-1,bg+:#262626
  --color=hl:#5f87af,hl+:#5fd7ff,info:#afaf87,marker:#87ff00
  --color=prompt:#d7005f,spinner:#af5fff,pointer:#af5fff,header:#87afaf
  --color=border:#262626,label:#aeaeae,query:#d9d9d9
  --border="rounded" --border-label="" --preview-window="border-rounded" --prompt="> "
  --marker=">" --pointer="◆" --separator="─" --scrollbar="│"'

# ===========================
# 7. Zoxide（更好的cd）
# ===========================
eval "$(zoxide init zsh)"

# ===========================
# 8. Zsh 插件
# ===========================
source "$HOME/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh"
source "$HOME/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
# source "$HOME/.zsh/zsh-autocomplete/zsh-autocomplete.plugin.zsh" # 速度较慢，视情况使用

# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/data1/liuhuijie/.miniconda/bin/conda' 'shell.zsh' 'hook' 2> /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "/data1/liuhuijie/.miniconda/etc/profile.d/conda.sh" ]; then
        . "/data1/liuhuijie/.miniconda/etc/profile.d/conda.sh"
    else
        export PATH="/data1/liuhuijie/.miniconda/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<

